<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGAE - UE Libertador Bolívar</title>
    <!-- Icono y Manifest para PWA -->
    <link rel="icon" type="image/png" href="assets/img/logo.png">
    <link rel="manifest" href="manifest.json">
    <!-- Fuentes y Estilos Externos -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- Estilo Personalizado -->
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

    <!-- CARGADOR GLOBAL (Loader) -->
    <div id="main-loader" class="loader-overlay">
        <div class="loader-box">
            <div class="loader-ring"></div>
            <img src="assets/img/logo.png" class="loader-img">
        </div>
    </div>

    <!-- PANTALLA DE ACCESO (LOGIN) -->
    <div id="login-screen" class="login-wrapper" style="display: none;">
        <div class="login-main-container animate__animated animate__fadeIn">
            <div class="login-grid">
                <!-- Lado Visual (Ondas y Logo) -->
                <div class="login-visual">
                    <div class="organic-waves">
                        <div class="wave wave1"></div>
                        <div class="wave wave2"></div>
                        <div class="wave wave3"></div>
                    </div>
                    <div class="visual-content text-center">
                        <img src="assets/img/logo.png" width="120" class="mb-4 bg-white rounded-circle p-2 shadow-lg logo-login-img">
                        <h2 class="fw-bold text-white">SIGAE</h2>
                        <p class="small text-white-50">Sistema Integral de Gestión <br> y Administración Escolar</p>
                    </div>
                </div>

                <!-- Lado del Formulario -->
                <div class="login-form-container d-flex align-items-center justify-content-center p-4">
                    <div class="card border-0 w-100 bg-transparent">
                        <div class="card-body p-2 p-md-4 text-center">
                            <h3 class="fw-bold mb-1" style="color: #0085FF;">¡Bienvenido!</h3>
                            <p class="text-muted small mb-4">Portal Institucional</p>
                            
                            <div id="login-flow">
                                <!-- Paso 1: Cédula -->
                                <div id="step-cedula">
                                    <div class="form-floating mb-3">
                                        <input type="number" id="inputCedula" class="form-control rounded-pill px-4 shadow-none border" placeholder="Cédula">
                                        <label class="px-4 text-muted">Cédula de Identidad</label>
                                    </div>
                                    <button onclick="App.verificarUsuario()" class="btn btn-primary-vibrant w-100 py-3 rounded-pill shadow fw-bold">Continuar</button>
                                    
                                    <!-- BOTÓN DE INVITADO -->
                                    <button onclick="App.modalInvitado()" class="btn btn-link btn-sm mt-3 text-secondary text-decoration-none w-100">
                                        <i class="bi bi-person-badge me-1"></i> Entrar como Invitado
                                    </button>
                                </div>

                                <!-- Paso 2: Contraseña -->
                                <div id="step-login" style="display:none;">
                                    <div class="badge bg-light text-primary p-2 px-3 mb-3 border w-100 text-truncate">
                                        <i class="bi bi-person-circle me-1"></i> <span id="lbl-nombre-login"></span>
                                    </div>
                                    <div class="input-group mb-3">
                                        <div class="form-floating flex-grow-1">
                                            <input type="password" id="inputPass" class="form-control rounded-start-pill px-4 shadow-none border" placeholder="Clave">
                                            <label class="px-4 text-muted">Contraseña</label>
                                        </div>
                                        <button class="btn btn-outline-vibrant rounded-end-pill px-3 border" type="button" onclick="App.togglePass('inputPass')">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </div>
                                    <button onclick="App.login()" class="btn btn-success-vibrant w-100 rounded-pill py-3 shadow fw-bold">Ingresar al Sistema</button>
                                    <button onclick="location.reload()" class="btn btn-link btn-sm mt-2 text-muted text-decoration-none">
                                        <i class="bi bi-arrow-left"></i> Cambiar Cédula
                                    </button>
                                </div>

                                <!-- Paso 3: Registro de Clave Nueva (Para usuarios nuevos) -->
                                <div id="step-register" style="display:none;">
                                    <div class="alert alert-info py-2 small mb-3 border-0" style="background:#e0f7fa; color:#006064;">
                                        Configure su contraseña de acceso
                                    </div>
                                    <div class="input-group mb-2">
                                        <input type="password" id="regPass" class="form-control rounded-pill px-4 shadow-none" placeholder="Nueva Clave">
                                    </div>
                                    <select id="regPregunta" class="form-select mb-2 py-3 rounded-pill px-4 shadow-none small border">
                                        <option value="">Pregunta de Seguridad</option>
                                        <option>¿Nombre de su mascota?</option>
                                        <option>¿Ciudad de nacimiento?</option>
                                        <option>¿Nombre de su escuela primaria?</option>
                                    </select>
                                    <input type="text" id="regRespuesta" class="form-control mb-3 py-3 rounded-pill px-4 shadow-none border" placeholder="Respuesta">
                                    <button onclick="App.registrarClave()" class="btn btn-warning-vibrant w-100 rounded-pill py-3 text-white fw-bold">Activar Cuenta</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ESTRUCTURA PRINCIPAL DE LA APLICACIÓN (SPA) -->
    <div id="app-wrapper" style="display: none;">
        <!-- BARRA LATERAL (Sidebar) -->
        <aside id="sidebar" class="sidebar-main shadow">
            <div class="sidebar-header" onclick="App.showDashboard()" style="cursor: pointer;">
                <img src="assets/img/logo.png" width="45">
                <div class="ms-3 text-dark text-start sidebar-text-header">
                    <div class="fw-bold small">UE Libertador Bolívar</div>
                    <div style="font-size: 0.6rem; color: #718096; letter-spacing: 0.5px;">GESTIÓN ACADÉMICA</div>
                </div>
                <button class="btn btn-link text-secondary ms-auto p-0 d-none d-lg-block" onclick="App.toggleCollapse()">
                    <i class="bi bi-list-task fs-4"></i>
                </button>
                <button class="btn btn-link text-secondary ms-auto p-0 d-lg-none" onclick="App.toggleSidebar()">
                    <i class="bi bi-x-lg fs-4"></i>
                </button>
            </div>
            
            <!-- CONTENEDOR DEL MENÚ DINÁMICO -->
            <div id="sidebar-menu" class="accordion accordion-flush mt-3 pb-5"></div>
        </aside>

        <!-- CONTENIDO PRINCIPAL -->
        <main id="main-content">
            <!-- Header Superior -->
            <header class="navbar sticky-top bg-white border-bottom px-4 py-3 shadow-sm">
                <button class="btn btn-light d-lg-none me-3" onclick="App.toggleSidebar()">
                    <i class="bi bi-list fs-4"></i>
                </button>
                <h6 class="mb-0 fw-bold text-secondary text-truncate" id="page-title">Cargando...</h6>
                
                <div class="ms-auto d-flex align-items-center">
                    <div class="text-end me-3 d-none d-md-block">
                        <div class="small fw-bold text-dark mb-0" id="user-display-name">---</div>
                        <div style="font-size: 0.65rem;" class="text-primary fw-bold text-uppercase">Conectado</div>
                    </div>
                    <button class="btn btn-light text-danger rounded-circle shadow-sm border ms-2" onclick="App.logout()" title="Cerrar Sesión">
                        <i class="bi bi-power"></i>
                    </button>
                </div>
            </header>

            <!-- Vistas Dinámicas -->
            <div id="dashboard-view" class="w-100"></div>
            <div id="dynamic-view" class="w-100" style="display:none;"></div>
        </main>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- html2canvas para descargar el organigrama -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Librerías para Captura y PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/app.js"></script>
</body>
</html>